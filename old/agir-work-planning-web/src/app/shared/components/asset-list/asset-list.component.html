<div
  class="d-flex justify-content-center list-height h-100"
  *ngIf="!selectedAssets?.length && !removedAssets?.length && !isLoading && !isReadOnly"
>
  <div class="d-flex flex-column justify-content-center align-items-center pb-10">
    <i class="icon icon-empty icon-xl mb-4"></i>
    <p class="font-md">Aucun actif sélectionné</p>
  </div>
</div>

<div *ngIf="isLoading">
  <div class="d-flex flex-column justify-content-center align-items-center">
    <app-spinner></app-spinner>
    <p class="font-md">Chargement des actifs</p>
  </div>
</div>

<div class="scrollable list-height h-100" *ngIf="!isLoading && (selectedAssets?.length || removedAssets?.length)">
  <div *ngIf="selectedAssets?.length" class="mr-1">
    <div
      class="item-list-hover border-bottom d-flex py-1"
      *ngFor="let selectedAsset of selectedAssets; let $index = index"
      (mouseenter)="hoverAsset(selectedAsset)"
      (mouseleave)="hoverAsset()"
      [ngClass]="{ hover: selectedAsset.highlighted }"
    >
      <div *ngIf="!isCreation && !isReadOnly">
        <button class="btn btn-icon btn-icon-only p-0 mb-1" (click)="removeAsset(selectedAsset)">
          <i class="icon icon-minus-circle-full icon-color-light-green icon-xs"></i>
        </button>
      </div>

      <div class="ml-1 w-100" [class.flex-1]="isCreation">
        <h5 class="text-dark" *ngIf="!canViewAssetDetails || !selectedAsset?.asset?.id">
          {{ selectedAsset.assetId !== '0' ? selectedAsset.assetId : (null | vdmNa) }}
        </h5>
        <h5 *ngIf="canViewAssetDetails && selectedAsset?.asset?.id">
          <a
            appWindowLink
            href="window/assets/{{ selectedAsset.asset.typeId }}/{{ selectedAsset.asset.id }}/overview"
            appStopProp
            >{{ selectedAsset.asset.id !== '0' ? selectedAsset.asset.id : (null | vdmNa) }}</a
          >
        </h5>
        <i
          class="icon float-right"
          *ngIf="isAssetHasProperties && !hasNexoReferenceNumber(selectedAsset)"
          (click)="collapse($index, selectedAsset.asset, listTypeAction.assetAdded)"
          [class.icon-chevron-up]="expandedIndex.includes($index + listTypeAction.assetAdded)"
          [class.icon-chevron-down]="!expandedIndex.includes($index + listTypeAction.assetAdded)"
          role="icon"
        ></i>
        <p class="d-flex align-items-center font-sm mb-0" *ngIf="isAssetTypeRoadway">
          Type d'actif: {{ selectedAsset?.asset?.typeId | appTaxonomy: 'assetType' }}
        </p>
        <p class="d-flex align-items-center font-sm mb-0">
          Propriétaire: {{ selectedAsset?.asset?.ownerId | appTaxonomy: 'assetOwner' }}
        </p>
        <p class="d-flex align-items-center font-sm mb-0">
          Dernière intervention: {{ selectedAsset.lastIntervention?.planificationYear | vdmNa }}
        </p>
        <p class="d-flex align-items-center font-sm mb-0" *ngIf="selectedAsset.asset.diameter">
          Diameter: {{ selectedAsset.asset.diameter | addUnits: ' mm' }}
        </p>
        <p class="d-flex align-items-center font-sm mb-0" *ngIf="selectedAsset.asset.material">
          Material: {{ selectedAsset.asset.material }}
        </p>
        <div
          class="description"
          *ngIf="expandedIndex.includes($index + listTypeAction.assetAdded) && !hasNexoReferenceNumber(selectedAsset)"
        >
          <div *ngFor="let property of properties; let i = index">
            <p class="d-flex align-items-center font-sm mb-0" *ngIf="i === 0">
              {{ property.code | appTaxonomy: TaxonomyGroup.assetDataKey }}: {{ property.value | vdmNa }}
            </p>
            <p class="d-flex align-items-center font-sm mb-0" *ngIf="i > 0">
              {{ property.code | appTaxonomy: TaxonomyGroup.assetDataKey }}: {{ property.value | vdmNa }}
            </p>
          </div>
        </div>
      </div>
      <div *ngIf="isCreation && !isReadOnly" class="d-flex">
        <button
          class="btn btn-icon btn-icon-only p-0 mr-2"
          (click)="deleteAsset(selectedAsset)"
          [disabled]="isGeneratingArea || selectedAssets?.length <= 1"
        >
          <i class="icon icon-trash"></i>
        </button>
      </div>
    </div>

    <div class="border-bottom py-1" *ngIf="removedAssets?.length"></div>
  </div>

  <div class="mt-2 mr-1" *ngIf="removedAssets?.length">
    <div
      class="item-list-hover border-bottom d-flex py-1"
      *ngFor="let removedAsset of removedAssets; let index = index"
    >
      <div>
        <button class="btn btn-icon btn-icon-only p-0 mb-1" (click)="addAsset(removedAsset)">
          <i class="icon icon-plus-circle-full icon-color-primary icon-xs"></i>
        </button>
      </div>
      <div class="ml-1 w-100">
        <h5>{{ removedAsset.asset?.id !== '0' ? removedAsset.asset.id : (null | vdmNa) }}</h5>
        <i
          class="icon float-right"
          *ngIf="isAssetHasProperties && !hasNexoReferenceNumber(selectedAsset)"
          (click)="collapse(index, removedAsset.asset, listTypeAction.assetRemoved)"
          [class.icon-chevron-up]="expandedIndex.includes(index + listTypeAction.assetRemoved)"
          [class.icon-chevron-down]="!expandedIndex.includes(index + listTypeAction.assetRemoved)"
          role="icon"
        ></i>
        <p class="d-flex align-items-center font-sm mb-0">
          Propriétaire: {{ removedAsset?.asset?.ownerId | appTaxonomy: 'assetOwner' }}
        </p>
        <p class="d-flex align-items-center font-sm mb-0">
          Dernière intervention: {{ removedAsset.lastIntervention?.planificationYear | vdmNa }}
        </p>
        <div
          class="description"
          *ngIf="expandedIndex.includes(index + listTypeAction.assetRemoved) && !hasNexoReferenceNumber(selectedAsset)"
        >
          <div *ngFor="let property of properties; let i = index">
            <p class="d-flex align-items-center font-sm mb-0" *ngIf="i === 0">
              {{ property.code | appTaxonomy: TaxonomyGroup.assetDataKey }}: {{ property.value | vdmNa }}
            </p>
            <p class="d-flex align-items-center font-sm mb-0" *ngIf="i > 0">
              {{ property.code | appTaxonomy: TaxonomyGroup.assetDataKey }}: {{ property.value | vdmNa }}
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="mt-4" *ngIf="showButtons">
  <button
    type="button"
    class="btn btn-primary btn-squared mr-2"
    (click)="submit()"
    [disabled]="!selectedAssets?.length"
  >
    Créer une intervention
  </button>
  <button type="button" class="btn btn-secondary btn-squared bg-white" (click)="reset()">
    Réinitialiser
  </button>
</div>
