<div class="details-overview p-4" *ngIf="project">
  <div class="mb-4 mr-4 flex-1">
    <h2>Vue d'ensemble du projet</h2>
    <p class="mt-1">{{ project.projectName }}</p>

    <table class="table-label-value flex-1 mt-2">
      <tbody>
        <tr *ngIf="projectProgramBooks?.length">
          <td>Carnets</td>
          <td>
            <div *ngFor="let programBook of projectProgramBooks">
              <a class="link-sm is-external-link" href="program-books/{{ programBook.id }}" appStopProp>
                {{ programBook?.annualProgram.executorId | appTaxonomy: TaxonomyGroup.executor }}
                {{ programBook?.annualProgram.year }} |
                {{ programBook?.name }}
              </a>
            </div>
          </td>
        </tr>
        <tr *ngIf="project.projectTypeId === ProjectType.nonIntegrated">
          <td>Programme</td>
          <td>{{ projectProgram | async }}</td>
        </tr>
        <tr *ngIf="Permission.PROJECT_BUDGET_READ | appPermission">
          <td>Budget</td>
          <td>{{ project.globalBudget.allowance | vdmCurrencyK | vdmNa }}</td>
        </tr>
        <tr *ngIf="project.medalId">
          <td class="pt-1">Médaille</td>
          <td>
            <app-medal [medalId]="project.medalId"></app-medal>
          </td>
        </tr>
      </tbody>
    </table>

    <div class="border-bottom my-4"></div>

    <div>
      <h4 class="my-2">Emplacement englobé</h4>
      <div class="d-flex justify-content-between">
        <table class="table-label-value flex-1">
          <tbody>
            <tr>
              <td>Arrondissement</td>
              <td>
                {{ project.boroughId | appTaxonomy: TaxonomyGroup.borough | vdmNa }}
              </td>
            </tr>
            <tr *ngIf="Permission.PROJECT_BUDGET_READ | appPermission">
              <td>Voie</td>
              <td>{{ project.streetName?.trim() | titlecase | vdmNa }}</td>
            </tr>
            <tr>
              <td>Longueur</td>
              <td>{{ project.length?.value | appMetersToKilometers }} km</td>
            </tr>
          </tbody>
        </table>
        <table class="table-label-value flex-1">
          <tbody>
            <tr *ngIf="project.streetFrom">
              <td class="td-sm">De</td>
              <td>
                {{ project.streetFrom }}
              </td>
            </tr>
            <tr *ngIf="project.streetTo">
              <td class="td-sm">À</td>
              <td>{{ project.streetTo }}</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="border-bottom my-4"></div>

      <div class="mb-4" *ngIf="project.interventions?.length">
        <h4 class="flex-grow-1 font-weight-bold mb-1">Interventions du projet</h4>
        <app-intervention-list #interventionList [items]="projectInterventions" [isReadOnly]="true">
        </app-intervention-list>
      </div>

      <div>
        <div class="d-flex justify-content-between align-items-center pb-1">
          <h4 class="flex-grow-1 font-weight-bold">Détails du projet</h4>
          <div *ngIf="(Permission.PROJECT_WRITE | appPermission) && (projectRestrictionItems | appRestrictions)">
            <button class="btn btn-secondary btn-squared" [disabled]="!canInteract" (click)="editProject()">
              <span class="icon icon-edit"></span>
              Éditer
            </button>
          </div>
        </div>
        <table class="d-flex align-item-start" *ngIf="project">
          <tbody class="table-label-value">
            <tr>
              <td>Type de projet</td>
              <td>{{ project.projectTypeId | appTaxonomy: TaxonomyGroup.projectType | vdmNa }}</td>
            </tr>
            <tr>
              <td>Exécutant</td>
              <td>{{ project.executorId | appTaxonomy: TaxonomyGroup.executor | vdmNa }}</td>
            </tr>
            <tr>
              <td>Requérant initial</td>
              <td>{{ project.inChargeId | appTaxonomy: TaxonomyGroup.requestor | vdmNa }}</td>
            </tr>
            <tr>
              <td>Arrondissement</td>
              <td>{{ project.boroughId | appTaxonomy: TaxonomyGroup.borough | vdmNa }}</td>
            </tr>
            <tr>
              <td>Catégorie(s)</td>
              <td>{{ project | vdmProjectCategories | vdmNa }}</td>
            </tr>
            <tr>
              <td>Période du projet</td>
              <td>De {{ project.startYear }} à {{ project.endYear }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="map border rounded" [class.invisible]="!mapShown">
    <app-map
      #map
      [withPanelMenu]="false"
      [withPanel]="false"
      [withRightPanel]="false"
      [withNonGeolocatedProjectsPanel]="false"
      [withPlanningBook]="false"
      [withInterventions]="false"
      [withProjects]="false"
      [initZoom]="25"
      [popupsEnabled]="false"
      [isLoading]="!mapInitialized"
      class="d-inline-block w-100 h-100"
    ></app-map>
  </div>
</div>
